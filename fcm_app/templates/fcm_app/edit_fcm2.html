{% extends 'base.html' %}

{% load static %}

{% block css %}
    <link href="{% static 'fcm_app/css/edit_fcm.css' %}" rel="stylesheet" />
    <link href="{% static 'fcm_app/css/import_fcm.css' %}" rel="stylesheet" />
    <style type="text/css">
        /*
        body, select {
            font: 10pt sans;
        }
        */
        #node-popUp{
            font-size: 14px;
        }
        #edge-popUp{
            font-size: 12px;
        }

        #node-popUp td, #edge-popUp td{
            border-style: none;
        }

        table input {
            width: 100%;
        }
        table textarea {
            width: 100%;
        }


        #mynetwork {
          position:relative;
          width: auto;
          height: 600px;
          border: 1px solid lightgray;
          clear:both;
        }
        table.legend_table {
          font-size: 11px;
          border-width:1px;
          border-color:#d3d3d3;
          border-style:solid;
        }
        table.legend_table,td {
          border-width:1px;
          border-color:#d3d3d3;
          border-style:solid;
          padding: 2px;
        }
        div.table_content {
          width:80px;
          text-align:center;
        }
        div.table_description {
          width:100px;
        }
        #operation {
          font-size:28px;
        }
        #node-popUp {
          display:none;
          position:absolute;
          top:350px;
          left:30vw;
          z-index:299;
          width:450px;
          height:250px;
          background-color: #f9f9f9;
          border-style:solid;
          border-width:3px;
          border-color: #5394ed;
          padding:10px;
          text-align: center;
          background-color: white;
          overflow: auto;
        }
        #edge-popUp {
          display:none;
          position:absolute;
          top:350px;
          left:30vw;
          z-index:299;
          width:450px;
          height:150px;
          background-color: #f9f9f9;
          border-style:solid;
          border-width:3px;
          border-color: #5394ed;
          padding:10px;
          text-align: center;
          background-color: white;
          overflow: auto;
        }
    </style>
{% endblock %}

{% block content %}

{#    {% if messages %}#}
{#        {% for message in messages %}#}
{#            {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}#}
{#                <div class="col-sm-8 col-sm-offset-2 alert alert-danger">#}
{#                    <p {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</p>#}
{#                </div>#}
{#            {% else %}#}
{#                <div class="col-sm-8 col-sm-offset-2 alert alert-success">#}
{#                    <p {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</p>#}
{#                </div>#}
{#            {% endif %}#}
{#        {% endfor %}#}
{##}
{#    {% endif %}#}



    <script type="text/javascript" src="http://visjs.org/examples/network/exampleUtil.js"></script>
	<script type="text/javascript" src="http://visjs.org/dist/vis.js"></script>
    <link href="http://visjs.org/dist/vis-network.min.css" rel="stylesheet" type="text/css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    {% if messages %}
        {% for message in messages %}
            {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
                <div class="col-sm-8 col-sm-offset-2 alert-dismissible alert alert-danger">
                     <p {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</p>
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div><br><br><br><br>
            {% else %}
                <div class="col-sm-8 col-sm-offset-2 alert-dismissible alert alert-success">
                    <p {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message|safe }}</p>
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div><br><br><br><br>
            {% endif %}
        {% endfor %}

    {% endif %}


<script type="text/javascript">
    var numOfNodes = 0;  //PREPEI NA PAIRNO TO NUM OF NODES APO OSOUS EINAI DIMIOURGIMENOI
    var numOfEdges = 0;   //PREPEI NA PAIRNO TO NUM OF EDGES APO OSOUS EINAI DIMIOURGIMENOI
    var test = 0;
    var nodes = null;
    var edges = null;
    var network = null;
    // randomly create some nodes and edges
    var data = getScaleFreeNetwork(0);
    console.log(data);
    var seed = 2;
    function setDefaultLocale() {
      var defaultLocal = navigator.language;
      var select = document.getElementById('locale');
      select.selectedIndex = 0; // set fallback value
      for (var i = 0, j = select.options.length; i < j; ++i) {
        if (select.options[i].getAttribute('value') === defaultLocal) {
          select.selectedIndex = i;
          break;
        }
      }
    }
    function destroy() {
      if (network !== null) {
        network.destroy();
        network = null;
      }
    }
    function draw() {
      destroy();
      nodes = [];
      edges = [];
      // create a network
      var container = document.getElementById('mynetwork');
      var options = {
        physics: {
          enabled: false
        },
        edges:{
            scaling:{
                  min:1,
                  max:10
            },
            arrows: {
                    to:     {enabled: true, scaleFactor:1, type:'arrow'},
                    middle: {enabled: false, scaleFactor:1, type:'arrow'},
                    from:   {enabled: false, scaleFactor:1, type:'arrow'}
            },
            arrowStrikethrough: false,
        },
        nodes: {
            shape: 'box',
            margin: 10,
            widthConstraint: {
                maximum: 400,
                minimum: 150
            },
            color: {
              border: '#dedede',
              background: '#dedede'
            },
            scaling:{
                label: {
                  min:1,
                  max:10
                }
            },
            font: {
                color:'white'
            },
        },
        layout: {randomSeed:seed}, // just to make sure the layout is the same when the locale is changed
        locale: document.getElementById('locale').value,
        manipulation: {
          addNode: function (data, callback) {
            console.log(data);
            // filling in the popup DOM elements
            document.getElementById('node-operation').innerHTML = "Add Node";
            editNodeAdd(data, clearNodePopUp, callback);
          },
          editNode: function (data, callback) {
            // filling in the popup DOM elements
            document.getElementById('node-operation').innerHTML = "Edit Node";
            editNodeEdit(data, cancelNodeEdit, callback);
          },
          addEdge: function (data, callback) {
            if (data.from == data.to) {
              var r = confirm("Do you want to connect the node to itself?");
              if (r != true) {
                callback(null);
                return;
              }
            }
            document.getElementById('edge-operation').innerHTML = "Add Edge";
            editEdgeWithoutDragAdd(data, callback);
          },
          editEdge: {
            editWithoutDrag: function(data, callback) {
              document.getElementById('edge-operation').innerHTML = "Edit Edge";
              editEdgeWithoutDragEdit(data,callback);
            }
          },
          deleteNode: function (info, callback){
            console.log("diagrafike komvos");
            var akmes = info.edges.length;
            if ( akmes!==0){
              var y =0; // dinei to id tis protis akmis pou tha diagrafei
              for (var i = akmes - 1; i >= 0; --i) {
                y = info.edges[i]
                for (var j = data.edges.length - 1; j >= 0; --j) {
                if (data.edges[j].id == y) {
                  console.log(j);
                  data.edges.splice(j,1);
                  break;
                }
              }
            }
            }
            var x = info.nodes[0] // dinei to id tou komvou pou tha diagrafei
            //var y = data.nodes.filter(item => ((item.id === x)))  //dinei ta stoixeia tou komvou pou theloume na diagrapsoume
            for (var i = data.nodes.length - 1; i >= 0; --i) {
              if (data.nodes[i].id == x) {
                console.log(i);
                data.nodes.splice(i,1);
                break;
              }
            }
            console.log(data);
            callback(info);
          },
          deleteEdge: function (info, callback){
            console.log("diagrafike akmi");
            var x = info.edges[0] // dinei to id tis akmis pou tha diagrafei
            //var y = data.nodes.filter(item => ((item.id === x)))  //dinei ta stoixeia tou komvou pou theloume na diagrapsoume
            for (var i = data.edges.length - 1; i >= 0; --i) {
              if (data.edges[i].id == x) {
                console.log(i);
                data.edges.splice(i,1);
                break;
              }
            }
            console.log(data);
            callback(info);
          }
        }
      };
      /*
      var lala = {"nodes":[{"id":0,"label":"0"},{"id":1,"label":"1"},{"id":2,"label":"2"},{"id":3,"label":"3"},{"id":4,"label":"4"},{"id":5,"label":"5"}],"edges":[{"from":1,"to":0,"id":"31f2e17b-5e4a-4e60-bc79-aeb2dde3800f"},{"from":2,"to":0,"id":"57c796d6-b560-4a24-b037-b8b03d3cdbb5"},{"from":3,"to":2,"id":"da8c3f78-d5ea-4cc2-b97b-bd09116dd6ba"},{"from":4,"to":3,"id":"4601698a-234f-4a45-9233-77bd970d70cb"},{"from":5,"to":4,"id":"3d83d4a2-4cea-45ac-b34d-23ebda61f387"}]}
      var lala2 = {"nodes":[{"id":1,"label":"Node 1","x":0,"y":0,"shape":"box"},{"id":2,"label":"Node 2","x":-308,"y":-144,"shape":"box"},{"id":3,"label":"Node 3","x":-319.5454545454545,"y":-52.45454545454549,"shape":"box"},{"id":4,"label":"Node 4","x":-312.27272727272725,"y":46.63636363636359,"shape":"box"},{"id":5,"label":"Node 5","x":-302.81818181818176,"y":136.090909090909,"shape":"box"},{"id":6,"label":"Node 6","x":-236.81818181818176,"y":49.09090909090901,"shape":"box"}],"edges":[{"id":1,"label":"1 se 0","from":2,"to":1},{"id":2,"label":"2 se 0","from":3,"to":1},{"id":3,"label":"3 se 2","from":4,"to":3},{"id":4,"label":"4 se 3","from":5,"to":4},{"id":5,"label":"5 se 4","from":6,"to":5}]}
      var lala3 = {"nodes":[{"id":1,"label":"Node 1","x":0,"y":0,"shape":"box"},{"id":2,"label":"Node 2","x":-308,"y":-144,"shape":"box"},{"id":3,"label":"Node 3","x":-319.5454545454545,"y":-52.45454545454549,"shape":"box"},{"id":4,"label":"Node 4","x":-312.27272727272725,"y":46.63636363636359,"shape":"box"},{"id":5,"label":"Node 5","x":-302.81818181818176,"y":136.090909090909,"shape":"box"},{"id":6,"label":"Node 6","x":-236.81818181818176,"y":49.09090909090901,"shape":"box"},{"id":7,"label":"sds","x":-310.05626649800604,"y":-149.29670101968725,"shape":"box"}],"edges":[{"id":1,"label":"1 se 0","from":2,"to":1},{"id":2,"label":"2 se 0","from":3,"to":1},{"id":3,"label":"3 se 2","from":4,"to":3},{"id":4,"label":"4 se 3","from":5,"to":4},{"id":5,"label":"5 se 4","from":6,"to":5}]}
      var lala4 = {"nodes":[{"id":1,"label":"aa","x":-334,"y":-181,"shape":"box"},{"id":2,"label":"bb","x":257,"y":-165,"shape":"box"},{"id":3,"label":"cc","x":-296,"y":162,"shape":"box"},{"id":4,"label":"dd","x":283,"y":159,"shape":"box"},{"id":5,"label":"ee","x":-14,"y":4,"shape":"box"}],"edges":[{"id":1,"label":"aaee","from":1,"to":5},{"id":2,"label":"bbee","from":5,"to":2}]}
      var lala5 = {"nodes":[{"id":"1","label":"aa","x":-334,"y":-181,"shape":"box"},{"id":"2","label":"bb","x":257,"y":-165,"shape":"box"},{"id":"3","label":"cc","x":"-296","y":"162","shape":"box"},{"id":"4","label":"dd","x":"283","y":"159","shape":"box"},{"id":"5","label":"ee","x":"-14","y":"4","shape":"box"}],"edges":[{"id":"1","label":"aaee","from":"1","to":"5"},{"id":"2","label":"bbee","from":"5","to":"2"}]}
      var lala6 = {"nodes":[{"id":1,"label":"aa","x":"0","y":"0","shape":"box"},{"id":2,"label":"bb","x":50,"y":0,"shape":"box"},{"id":3,"label":"cc","shape":"box"},{"id":4,"label":"dd","shape":"box"},{"id":5,"label":"ee","shape":"box"}],"edges":[{"id":1,"label":"aaee","from":1,"to":5},{"id":2,"label":"bbee","from":5,"to":2}]}
      var sketos = {"nodes":[{"id":0,"label":"sketos", "fixed": true, "x":0,"y":0, "shape":"box"}, {"id":1,"label":"sketos1", "fixed": true, "x":0,"y":0, "shape":"box"}],"edges":[]}
      var lala7 = {"nodes":[{"id":1,"label":"vv","x":-339.97569465637207,"y":-212.6944580078125,"shape":"box","fixed":true},{"id":2,"label":"bb","x":237.02430534362793,"y":19.3055419921875,"shape":"box","fixed":true},{"id":3,"label":"cc","x":-313.97569465637207,"y":159.3055419921875,"shape":"box","fixed":true}],"edges":[{"id":1,"label":"cc","from":1,"to":2},{"id":2,"label":"cvbcv","from":3,"to":2}]}
      data = lala7;
      */
      var data1 = {{ fcm.chartis|safe }};  // pernao ta dedomena apo piso
      data = data1;
      let arxikos_chartis = JSON.parse(JSON.stringify(data)); //mono etsi den einai me reference
      //var arxikos_chartis = JSON.stringify(data);
      document.getElementById('id_arxikos_chartis').value= JSON.stringify(arxikos_chartis);
      // vgazo to fixed apo tous komvous gia na mporoun na allaksoun thesi
      for (var i = data1.nodes.length - 1; i >= 0; --i) {
            delete data1.nodes[i].fixed;
      }
      if (data1.nodes.length-1 < 0){
        numOfNodes = 0
      }
      else{
        numOfNodes = data1.nodes[data1.nodes.length-1].id;
      }
      if (data1.edges.length-1 < 0){
        numOfEdges = 0
      }
      else{
        numOfEdges = data1.edges[data1.edges.length-1].id;
      }
      grafos = data1;
      test = data1;
      console.log(test);
      network = new vis.Network(container, data1, options);  // dimiourgia tou network
      network.enableEditMode();
{#        network.on("click", function (ctx) {#}
{#            var dataURL = ctx.canvas.toDataURL();#}
{#            document.getElementById('canvasImg').src = dataURL;#}
{#        });#}
    }
    function editNodeEdit(info, cancelAction, callback) {
      console.log(data);
      console.log(info.id);
      console.log(info.label);
      document.getElementById('node-label').value = info.label;
      document.getElementById('node-saveButton').onclick = saveNodeDataEdit.bind(this, info, callback);
      document.getElementById('node-cancelButton').onclick = cancelAction.bind(this, callback);
      document.getElementById('node-popUp').style.display = 'block';
    }

    function editNodeAdd(info, cancelAction, callback) {
      console.log(data);
      console.log(info.id);
      console.log(info.label);
      document.getElementById('node-label').value = info.label;
      document.getElementById('node-saveButton').onclick = saveNodeDataAdd.bind(this, info, callback);
      document.getElementById('node-cancelButton').onclick = cancelAction.bind(this, callback);
      document.getElementById('node-popUp').style.display = 'block';
    }
    // Callback passed as parameter is ignored
    function clearNodePopUp() {
      document.getElementById('node-saveButton').onclick = null;
      document.getElementById('node-cancelButton').onclick = null;
      document.getElementById('node-popUp').style.display = 'none';
    }
    function cancelNodeEdit(callback) {
      clearNodePopUp();
      callback(null);
    }
    function saveNodeDataAdd(info, callback) {
      info.label = document.getElementById('node-label').value;
      numOfNodes++;
      info.id = numOfNodes;
      info.shape = document.getElementById('node-shape').value;

      info.color = document.getElementById('node-color').value;
      console.log(info);
      //info.title = document.getElementById('node-title').value;
      data.nodes.push({
        id: info.id,
        label: info.label,
        color: info.color,
        x: info.x,
        y: info.y,
        shape: info.shape,
        fixed: true
      });
      clearNodePopUp();
      callback(info);
    }
    function saveNodeDataEdit(info, callback) {
      info.label = document.getElementById('node-label').value;

      info.color = document.getElementById('node-color').value;
      info.shape = document.getElementById('node-shape').value;


      var x = data.nodes;
      var y = x.filter(item => ((item.id === info.id) ));
      y[0].label = info.label;
      y[0].color = info.color;
      y[0].shape = info.shape;

      <!--var x = network.body.nodes;-->
      <!--var x = network.body.data.nodes._data-->
      <!--var arr = []-->
      <!--for (var prop in x) {-->
        <!--arr.push(x[prop]);-->
      <!--}-->
      <!--var y = arr.filter(item => ((item.id === info.id) ))-->

      clearNodePopUp();
      callback(info);
    }
    function editEdgeWithoutDragAdd(data, callback) {
      // filling in the popup DOM elements
      document.getElementById('edge-label').value = data.label;
      document.getElementById('edge-saveButton').onclick = saveEdgeDataAdd.bind(this, data, callback);
      document.getElementById('edge-cancelButton').onclick = cancelEdgeEdit.bind(this,callback);
      document.getElementById('edge-popUp').style.display = 'block';
    }
    function editEdgeWithoutDragEdit(data, callback) {
      // filling in the popup DOM elements
      document.getElementById('edge-label').value = data.label;
      document.getElementById('edge-saveButton').onclick = saveEdgeDataEdit.bind(this, data, callback);
      document.getElementById('edge-cancelButton').onclick = cancelEdgeEdit.bind(this,callback);
      document.getElementById('edge-popUp').style.display = 'block';
    }
    function clearEdgePopUp() {
      document.getElementById('edge-saveButton').onclick = null;
      document.getElementById('edge-cancelButton').onclick = null;
      document.getElementById('edge-popUp').style.display = 'none';
    }
    function cancelEdgeEdit(callback) {
      clearEdgePopUp();
      callback(null);
    }
    function saveEdgeDataAdd(info, callback) {
      if (typeof info.to === 'object')
        info.to = info.to.id
      if (typeof info.from === 'object')
        info.from = info.from.id
      var label = document.getElementById('edge-label').value;
      var color = "grey";
      var w = 0;
      if (label !== "") {
          w = parseFloat(label);
          if (w > 0)
              color = "#86d286";
          else {
              color = "#ff8383";
              w = w * (-1)
          }
      }

      info.label = label;
      info.width = (w * 10) + 1;
      info.color = { color: color };
      numOfEdges++;
      info.id = numOfEdges;
      data.edges.push({
        id: info.id,
        arrows:'to',
        label: info.label,
        from: info.from,
        to: info.to,
        label: label,
        width: (w * 10) + 1,
        color: { color: color }

      });
      clearEdgePopUp();
      callback(info);
    }
    function saveEdgeDataEdit(info, callback) {
      if (typeof info.to === 'object')
        info.to = info.to.id;
      if (typeof info.from === 'object')
        info.from = info.from.id;
      var label = document.getElementById('edge-label').value;
      var color = "grey";
      var w = 0;
      if (label !== "") {
          w = parseFloat(label);
          if (w > 0)
              color = "#86d286";
          else {
              color = "#ff8383";
              w = w * (-1)
          }
      }

      info.label = label;
      info.width = (w * 10) + 1;
      info.color = { color: color };

      var x = data.edges;
      var y = x.filter(item => ((item.id === info.id) ))
      y[0].label = info.label;
      y[0].width = (w * 10) + 1;
      y[0].color = { color: color };
      clearEdgePopUp();
      callback(info);
    }
    function init() {
      setDefaultLocale();
      draw();
    }
    var lastdata = "blabla";
    function kaneStringToData(){
      for (var i = data.nodes.length - 1; i >= 0; --i) {  //vazo ksana to fixed stous komvous gia na einai stathero sto view
            data.nodes[i].fixed = true;
      }
      for (var i = data.nodes.length - 1; i >= 0; --i) {
            data.nodes[i].x = network.canvas.body.nodes[data.nodes[i].id].x;
            data.nodes[i].y = network.canvas.body.nodes[data.nodes[i].id].y;
      }
      console.log(lastdata);
      lastdata = JSON.stringify(data);   // metatrepei se string to data
      document.getElementById('id_chartis').value = lastdata;
      console.log(lastdata);
      //document.getElementById('timi_pou_thelo').value = lastdata;
      //document.getElementById('id_description').value = lastdata;
    }

    window.onload = init;  //Na mpei kai sta upoloipa

  </script>

<!--<body onload="init(); ">-->
<div class="container text-center create-fcm-container">
    <div class="col-sm-offset-1 col-sm-10 edit-fcm-container">
        <h1 class="col-sm-12" style="text-align: center">Edit the {{ fcm.title }}</h1>
    </div>
    <br>

    <div class="col-sm-12">
        <div class="col-sm-6 col-sm-offset-3">
            <a id="publish-link-btn" href="#publish_form" class="btn btn-default" style="background-color: #327666;">Publish</a>
            <a id="cancel-link-btn" href="/fcm/browse" class="btn btn-default">Cancel</a>
        </div>
        <div class="col-sm-2">
            <btn class="btn btn-default" style="text-transform: inherit;"><a href="{% url 'fcm_app:view_fcm_concept' fcm_id=fcm.id %}">Edit Concepts and Relations</a></btn>
        </div>
    </div>
    <!--<h1>Create a new...</h1>-->

    <!--<div class="panel panel-default">-->
        <!--<div class="panel-body">-->
            <!--In the editor below you can create your own causal model or edit and save under another name an existing one. <br/>-->
            <!--The model consists of nodes representing concepts (“income”, “unemployment”, etc.) and cause-effect relationships between them.-->
        <!--</div>-->
    <!--</div>-->

    <!--<a id="publish-link-btn" href="#publish_form" class="btn btn-default">Publish</a>-->

    <p style="display: none;">
      <label for="locale">Select a locale:</label>
      <select id="locale" onchange="draw();">
        <option value="en">en</option>
      </select>
    </p>


    <div id="node-popUp">
      <span id="node-operation">node</span> <br>
      <table style="margin: 0;width: 100%;">
        <tr hidden>
          <td>id</td><td><input id="node-id" value="la"/></td>
        </tr>
        <tr>
            <td>Label</td><td><textarea cols="40" rows="5" id="node-label" value="la" ></textarea></td>
        </tr>
        <tr>
          <td>Color</td>
            <td>
                <select id="node-color" style="width: 100%">
                    <option value="#6c6c6c" selected>Grey</option>
                    <option value="#8d2b2b" >Red</option>
                    <option value="#327666" >Green</option>
                    <option value="#34477b" >Blue</option>
                    <option value="#684126" >Brown</option>
                </select>
            </td>
        </tr>
          <tr>
               <td>Shape</td>
              <td>
                  <select id="node-shape" style="width: 100%">
                    <option value="box" selected>Box</option>
                    <option value="ellipse" >Ellipse</option>
                </select>
              </td>
          </tr>
{#        <tr>#}
{#            <td>Width</td><td  class="slidecontainer"><span id="demo"></span><input type="range" min="1" max="100" value="50" class="slider" id="myRange"></td>#}
{#        </tr>#}
        <!--tr>
          <td>title</td><td><input id="node-title" value="" /></td>
        </tr-->
      </table>
      <input type="button" value="save" id="node-saveButton" />
      <input type="button" value="cancel" id="node-cancelButton" />
    </div>

    <div id="edge-popUp">
      <span id="edge-operation">edge</span> <br>
      <table style="margin: 0;width: 100%;">
        <tr>
          <td style="width: 75px;">weight</td><td><input id="edge-label" type="number" min="-1" max="1" step="0.1" value="new value" onkeyup="this.value = minmax(this.value, -1, 1)"/></td>
        </tr>
      </table>
      <input type="button" value="save" id="edge-saveButton" />
      <input type="button" value="cancel" id="edge-cancelButton" />
    </div>
    <!--div>
    <form class="form-horizontal" action="{% url 'fcm_app:create_map' %}" method="post" enctype="multipart/form-data">
    {#  {% csrf_token %}#}
      <div>
        <input id="search" name="search" type="text" class="query-search" placeholder="Search...">
        <button type="submit" onclick="kaneStringToData()">Save</button>
        <input class="btn btn-primary" type="submit" value="submit">

      </div>
    </form>
    </div-->

    <br/>
    <div class="col-sm-offset-1 col-sm-10 panel panel-default" style="padding: 0; margin-top: 0;">
        <div id="mynetwork"></div>
    </div>
</div>
<br/>


    <div class="col-sm-offset-1 col-sm-10 panel panel-default" id="publish_form">
        <div class="panel-body">
            <form method="post">
                {% csrf_token %}
                {{ form }}
                {{ form1 }}
                <!--<div id="arxikos_chartis" name="arxikos_chartis" style="display: none;" value="blabla"></div>-->
                <input type="submit" value="Save" onclick="kaneStringToData()" class="btn btn-success">
            </form>
        </div>
    </div>




    <div class="col-sm-2 col-sm-offset-9">
        <btn id="delete-fcm" class="btn btn-danger" style="float: right;">Delete</btn>
    </div>

    <div style="display: none;">
        <div id="dialog" style="text-align: center">
            <p>Are you sure you want to delete the System Map?</p>
            <btn id="cancel-delete" class="btn btn-default">Cancel</btn>
            <btn id="confirm-delete" class="btn btn-danger"><a href="{% url 'fcm_app:delete_fcm' fcm_id=fcm.id %}"> Delete </a></btn>
        </div>
    </div>

{% endblock %}

{% block js %}

    <script>
        $(document).ready(function () {
             $('#id_tags').select2({
                tags:true,
                tokenSeparators: [',', ' ']
            });
            $('#id_country').select2();
        });


        $("#delete-fcm").click(function () {
           $( "#dialog" ).dialog();
        });

        $("#cancel-delete").click(function () {
            $(this).closest('.ui-dialog-content').dialog('close');
        });

    </script>


{% endblock %}